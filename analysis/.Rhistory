narwhal_rink_AU18 <- read.csv(paste(path,"narwhal_detections/Rink_Glacier_2018-19_AuralM2_daily.csv",sep=''))%>% mutate(glacier="rink",device="aural")%>% select(Time_UTC, narwhal,glacier,device)
narwhal_fish_AU19 <- read.csv(paste(path,"narwhal_detections/Rink_Glacier_Fischer_AuralM2_daily.csv",sep=''))%>% mutate(glacier="rink",device="aural")%>% select(Time_UTC, narwhal,glacier,device)
narwhal_fish_ST19 <- read.csv(paste(path,"narwhal_detections/Rink_Glacier_Fischer_ST_daily.csv",sep=''))%>% mutate(glacier="rink",device="soundtrap")%>% select(Time_UTC, narwhal,glacier,device)
narwhal_sver_AU18 <- read.csv(paste(path,"narwhal_detections/Sverdrup2018-19_AuralM2_daily.csv",sep=''))%>% mutate(glacier="sver",device="aural")%>% select(Time_UTC, narwhal,glacier,device)
narwhal_dets <- rbind(narwhal_kong_AU18,
narwhal_kong_AU19,
narwhal_kong_ST19,
narwhal_rink_AU18,
narwhal_fish_AU19,
narwhal_fish_ST19,
narwhal_sver_AU18) %>%
mutate(time=as.character(strptime(as.Date(Time_UTC,format=c('%Y/%b/%d')),format='%Y-%m-%d'))) %>% select(!Time_UTC)
# pool soundtrap and aural detections for 2019 data (i.e., take only one obs/day for each site)
narwhal_pooled <- narwhal_dets %>% group_by(glacier,time) %>%
filter(narwhal==max(narwhal),(row_number()==n()))
# ice velocity
kong_ice_vel <- read.csv(paste(path,"glacier_ice_velocity/kongoscar_ice_velocity_1D.csv",sep=''))%>% mutate(glacier="kong")
rink_ice_vel <- read.csv(paste(path,"glacier_ice_velocity/rink_ice_velocity_1D.csv",sep='')) %>% mutate(glacier="rink")
sver_ice_vel <- read.csv(paste(path,"glacier_ice_velocity/sverdrup_ice_velocity_1D.csv",sep='')) %>% mutate(glacier="sver")
ice_vel<-rbind(kong_ice_vel,rink_ice_vel,sver_ice_vel)
# glacier length (= terminus position)
kong_glacier_length <- read.csv(paste(path,"glacier_length/kongoscar_glacier_length_1D.csv",sep=''))%>% mutate(glacier="kong")
rink_glacier_length <- read.csv(paste(path,"glacier_length/rink_glacier_length_1D.csv",sep=''))%>% mutate(glacier="rink")
sver_glacier_length <- read.csv(paste(path,"glacier_length/sverdrup_glacier_length_1D.csv",sep=''))%>% mutate(glacier="sver")
glacier_len<-rbind(kong_glacier_length,rink_glacier_length,sver_glacier_length)
# runoff
runoff_kong <- read.csv(paste(path,"runoff/kongoscar_runoff_1D.csv",sep=''))%>% mutate(glacier="kong")
runoff_rink <- read.csv(paste(path,"runoff/rink_runoff_1D.csv",sep=''))%>% mutate(glacier="rink")
runoff_sver <- read.csv(paste(path,"runoff/sverdrup_runoff_1D.csv",sep=''))%>% mutate(glacier="sver")
runoff<-rbind(runoff_kong,runoff_rink,runoff_sver)
# sea ice
sea_ice_rink <- read.csv(paste(path,"sea_ice/fisher_seaice_cover_1D.csv",sep=''))%>% mutate(glacier="rink")
sea_ice_kong <- read.csv(paste(path,"sea_ice/kongoscar_seaice_cover_1D.csv",sep=''))%>% mutate(glacier="kong")
sea_ice_sver <- read.csv(paste(path,"sea_ice/sverdrup_seaice_cover_1D.csv",sep=''))%>% mutate(glacier="sver")
sea_ice<-rbind(sea_ice_rink,sea_ice_kong,sea_ice_sver)
# salinity
salt_surf_fish <- read.csv(paste(path,"salinity/fisher_salt_120m_1D.csv",sep=''))%>% mutate(glacier="rink")
salt_deep_fish <- read.csv(paste(path,"salinity/fisher_salt_220m_1D.csv",sep=''))%>% mutate(glacier="rink")
salt_surf_kong <- read.csv(paste(path,"salinity/kongoscar_salt_120m_1D.csv",sep=''))%>% mutate(glacier="kong") %>% mutate(time=as.character(as.Date(time,format='%m/%d/%Y')))
salt_deep_kong <- read.csv(paste(path,"salinity/kongoscar_salt_220m_1D.csv",sep=''))%>% mutate(glacier="kong")
salt_surf_rink <- read.csv(paste(path,"salinity/rink_salt_120m_1D.csv",sep=''))%>% mutate(glacier="rink")
salt_deep_rink <- read.csv(paste(path,"salinity/rink_salt_220m_1D.csv",sep=''))%>% mutate(glacier="rink")
salt_surf_sver <- read.csv(paste(path,"salinity/sverdrup_salt_120m_1D.csv",sep=''))%>% mutate(glacier="sver")
salt_deep_sver <- read.csv(paste(path,"salinity/sverdrup_salt_220m_1D.csv",sep=''))%>% mutate(glacier="sver")
salt_surf<-rbind(salt_surf_fish,salt_surf_kong,salt_surf_rink,salt_surf_sver) %>% rename(salt_surf=salinity)
salt_deep<-rbind(salt_deep_fish,salt_deep_kong,salt_deep_rink,salt_deep_sver) %>% rename(salt_deep=salinity)
# temperature
temp_surf_fish <- read.csv(paste(path,"temperature/fisher_temp_120m_1D.csv",sep=''))%>% mutate(glacier="rink")
temp_deep_fish <- read.csv(paste(path,"temperature/fisher_temp_220m_1D.csv",sep=''))%>% mutate(glacier="rink")
temp_surf_kong <- read.csv(paste(path,"temperature/kongoscar_temp_120m_1D.csv",sep=''))%>% mutate(glacier="kong")
temp_deep_kong <- read.csv(paste(path,"temperature/kongoscar_temp_220m_1D.csv",sep=''))%>% mutate(glacier="kong")
temp_surf_rink <- read.csv(paste(path,"temperature/rink_temp_120m_1D.csv",sep=''))%>% mutate(glacier="rink")
temp_deep_rink <- read.csv(paste(path,"temperature/rink_temp_220m_1D.csv",sep=''))%>% mutate(glacier="rink")
temp_surf_sver <- read.csv(paste(path,"temperature/sverdrup_temp_120m_1D.csv",sep=''))%>% mutate(glacier="sver")
temp_deep_sver <- read.csv(paste(path,"temperature/sverdrup_temp_220m_1D.csv",sep=''))%>% mutate(glacier="sver")
temp_surf <- rbind(temp_surf_fish,temp_surf_kong,temp_surf_rink,temp_surf_sver) %>% rename(temp_surf=temperature)
temp_deep <- rbind(temp_deep_fish,temp_deep_kong,temp_deep_rink,temp_deep_sver) %>% rename(temp_deep=temperature)
# table of additional glacier variables
glacier_vars_df <- read.csv(paste(path,"narwhal_model_glacier_vars.csv",sep=''))
## make data tidy and join all vars into one df
# ALL narwhal detections (aural + soundtrap)
model_vars_df <- runoff %>% left_join(salt_surf, by = c('time', 'glacier')) %>%
left_join(salt_deep, by = c('time', 'glacier')) %>%
left_join(temp_surf, by = c('time', 'glacier')) %>%
left_join(temp_deep, by = c('time', 'glacier')) %>%
left_join(sea_ice, by = c('time', 'glacier')) %>%
left_join(ice_vel, by = c('time', 'glacier')) %>%
left_join(glacier_len, by = c('time', 'glacier')) %>%
left_join(narwhal_dets, by = c('time', 'glacier')) %>%
mutate(DOY=as.numeric(strftime(as.Date(time),format='%j')),
year = strftime(as.Date(time),format='%Y'))
# pooled narwhal detections (i.e., any positive detection from Aural or ST = 1)
narwhal_pooled_dets <- narwhal_pooled %>% select(narwhal, glacier, time)
model_vars_pooled_df <- runoff %>% left_join(salt_surf, by = c('time', 'glacier')) %>%
left_join(salt_deep, by = c('time', 'glacier')) %>%
left_join(temp_surf, by = c('time', 'glacier')) %>%
left_join(temp_deep, by = c('time', 'glacier')) %>%
left_join(sea_ice, by = c('time', 'glacier')) %>%
left_join(ice_vel, by = c('time', 'glacier')) %>%
left_join(glacier_len, by = c('time', 'glacier')) %>%
left_join(narwhal_pooled_dets, by = c('time', 'glacier')) %>%
mutate(DOY=as.numeric(strftime(as.Date(time),format='%j')),
year = strftime(as.Date(time),format='%Y'))
# check to make sure values are
model_vars_df %>% filter(time=='2019-09-30')
narwhal_kong_AU18 <- read.csv(paste(path,"narwhal_detections/Kong_Oscar_2018-2019_AuralM2_daily.csv",sep=''))%>% mutate(glacier="kong",device="aural") %>% select(Time_UTC, narwhal,glacier,device)
narwhal_kong_AU19 <- read.csv(paste(path,"narwhal_detections/Nuussuaq_KongOscar_AuralM2_daily.csv",sep=''))%>% mutate(glacier="kong",device="aural")%>% select(Time_UTC, narwhal,glacier,device)
narwhal_kong_ST19 <- read.csv(paste(path,"narwhal_detections/Nuussuaq_KongOscar_ST_daily.csv",sep=''))%>% mutate(glacier="kong",device="soundtrap")%>% select(Time_UTC, narwhal,glacier,device)
narwhal_rink_AU18 <- read.csv(paste(path,"narwhal_detections/Rink_Glacier_2018-19_AuralM2_daily.csv",sep=''))%>% mutate(glacier="rink",device="aural")%>% select(Time_UTC, narwhal,glacier,device)
narwhal_fish_AU19 <- read.csv(paste(path,"narwhal_detections/Rink_Glacier_Fischer_AuralM2_daily.csv",sep=''))%>% mutate(glacier="rink",device="aural")%>% select(Time_UTC, narwhal,glacier,device)
narwhal_fish_ST19 <- read.csv(paste(path,"narwhal_detections/Rink_Glacier_Fischer_ST_daily.csv",sep=''))%>% mutate(glacier="rink",device="soundtrap")%>% select(Time_UTC, narwhal,glacier,device)
narwhal_sver_AU18 <- read.csv(paste(path,"narwhal_detections/Sverdrup2018-19_AuralM2_daily.csv",sep=''))%>% mutate(glacier="sver",device="aural")%>% select(Time_UTC, narwhal,glacier,device)
narwhal_kong_AU18 <- read.csv(paste(path,"narwhal_detections/Kong_Oscar_2018-2019_AuralM2_daily.csv",sep=''))%>% mutate(glacier="kong",device="aural")
narwhal_kong_AU18
narwhal_kong_AU18 <- read.csv(paste(path,"narwhal_detections/Kong_Oscar_2018-2019_AuralM2_daily.csv",sep=''))%>% mutate(glacier="kong",device="aural") %>% select(Time_UTC, narwhal,glacier,device)
library(tidyverse)
library(corrplot)
library(MuMIn)
library(arm)
library(faraway)
narwhal_kong_AU18 <- read.csv(paste(path,"narwhal_detections/Kong_Oscar_2018-2019_AuralM2_daily.csv",sep=''))%>% mutate(glacier="kong",device="aural") %>% select(Time_UTC, narwhal,glacier,device)
library(tidyverse)
library(corrplot)
library(MuMIn)
library(arm)
library(faraway)
# use this line to list all filenames in specified directory
# files = list.files(path='D:/Habitat_model_data/covariate_csv_files',pattern = '*.csv',recursive = TRUE)
# data stored on external harddrive -- update path here
path <- 'D:/Habitat_model_data/covariate_csv_files/'
## load all data from csv files and add columns to indicate glacier/site and device (where applicable)
## then join all data into one dataframe per variable
# narwhal detections
narwhal_kong_AU18 <- read.csv(paste(path,"narwhal_detections/Kong_Oscar_2018-2019_AuralM2_daily.csv",sep=''))%>% mutate(glacier="kong",device="aural") %>% select(Time_UTC, narwhal,glacier,device)
narwhal_kong_AU19 <- read.csv(paste(path,"narwhal_detections/Nuussuaq_KongOscar_AuralM2_daily.csv",sep=''))%>% mutate(glacier="kong",device="aural")%>% select(Time_UTC, narwhal,glacier,device)
narwhal_kong_ST19 <- read.csv(paste(path,"narwhal_detections/Nuussuaq_KongOscar_ST_daily.csv",sep=''))%>% mutate(glacier="kong",device="soundtrap")%>% select(Time_UTC, narwhal,glacier,device)
narwhal_rink_AU18 <- read.csv(paste(path,"narwhal_detections/Rink_Glacier_2018-19_AuralM2_daily.csv",sep=''))%>% mutate(glacier="rink",device="aural")%>% select(Time_UTC, narwhal,glacier,device)
narwhal_fish_AU19 <- read.csv(paste(path,"narwhal_detections/Rink_Glacier_Fischer_AuralM2_daily.csv",sep=''))%>% mutate(glacier="rink",device="aural")%>% select(Time_UTC, narwhal,glacier,device)
narwhal_fish_ST19 <- read.csv(paste(path,"narwhal_detections/Rink_Glacier_Fischer_ST_daily.csv",sep=''))%>% mutate(glacier="rink",device="soundtrap")%>% select(Time_UTC, narwhal,glacier,device)
narwhal_sver_AU18 <- read.csv(paste(path,"narwhal_detections/Sverdrup2018-19_AuralM2_daily.csv",sep=''))%>% mutate(glacier="sver",device="aural")%>% select(Time_UTC, narwhal,glacier,device)
narwhal_dets <- rbind(narwhal_kong_AU18,
narwhal_kong_AU19,
narwhal_kong_ST19,
narwhal_rink_AU18,
narwhal_fish_AU19,
narwhal_fish_ST19,
narwhal_sver_AU18) %>%
mutate(time=as.character(strptime(as.Date(Time_UTC,format=c('%Y/%b/%d')),format='%Y-%m-%d'))) %>% select(!Time_UTC)
# pool soundtrap and aural detections for 2019 data (i.e., take only one obs/day for each site)
narwhal_pooled <- narwhal_dets %>% group_by(glacier,time) %>%
filter(narwhal==max(narwhal),(row_number()==n()))
# ice velocity
kong_ice_vel <- read.csv(paste(path,"glacier_ice_velocity/kongoscar_ice_velocity_1D.csv",sep=''))%>% mutate(glacier="kong")
rink_ice_vel <- read.csv(paste(path,"glacier_ice_velocity/rink_ice_velocity_1D.csv",sep='')) %>% mutate(glacier="rink")
sver_ice_vel <- read.csv(paste(path,"glacier_ice_velocity/sverdrup_ice_velocity_1D.csv",sep='')) %>% mutate(glacier="sver")
ice_vel<-rbind(kong_ice_vel,rink_ice_vel,sver_ice_vel)
# glacier length (= terminus position)
kong_glacier_length <- read.csv(paste(path,"glacier_length/kongoscar_glacier_length_1D.csv",sep=''))%>% mutate(glacier="kong")
rink_glacier_length <- read.csv(paste(path,"glacier_length/rink_glacier_length_1D.csv",sep=''))%>% mutate(glacier="rink")
sver_glacier_length <- read.csv(paste(path,"glacier_length/sverdrup_glacier_length_1D.csv",sep=''))%>% mutate(glacier="sver")
glacier_len<-rbind(kong_glacier_length,rink_glacier_length,sver_glacier_length)
# runoff
runoff_kong <- read.csv(paste(path,"runoff/kongoscar_runoff_1D.csv",sep=''))%>% mutate(glacier="kong")
runoff_rink <- read.csv(paste(path,"runoff/rink_runoff_1D.csv",sep=''))%>% mutate(glacier="rink")
runoff_sver <- read.csv(paste(path,"runoff/sverdrup_runoff_1D.csv",sep=''))%>% mutate(glacier="sver")
runoff<-rbind(runoff_kong,runoff_rink,runoff_sver)
# sea ice
sea_ice_rink <- read.csv(paste(path,"sea_ice/fisher_seaice_cover_1D.csv",sep=''))%>% mutate(glacier="rink")
sea_ice_kong <- read.csv(paste(path,"sea_ice/kongoscar_seaice_cover_1D.csv",sep=''))%>% mutate(glacier="kong")
sea_ice_sver <- read.csv(paste(path,"sea_ice/sverdrup_seaice_cover_1D.csv",sep=''))%>% mutate(glacier="sver")
sea_ice<-rbind(sea_ice_rink,sea_ice_kong,sea_ice_sver)
# salinity
salt_surf_fish <- read.csv(paste(path,"salinity/fisher_salt_120m_1D.csv",sep=''))%>% mutate(glacier="rink")
salt_deep_fish <- read.csv(paste(path,"salinity/fisher_salt_220m_1D.csv",sep=''))%>% mutate(glacier="rink")
salt_surf_kong <- read.csv(paste(path,"salinity/kongoscar_salt_120m_1D.csv",sep=''))%>% mutate(glacier="kong") %>% mutate(time=as.character(as.Date(time,format='%m/%d/%Y')))
salt_deep_kong <- read.csv(paste(path,"salinity/kongoscar_salt_220m_1D.csv",sep=''))%>% mutate(glacier="kong")
salt_surf_rink <- read.csv(paste(path,"salinity/rink_salt_120m_1D.csv",sep=''))%>% mutate(glacier="rink")
salt_deep_rink <- read.csv(paste(path,"salinity/rink_salt_220m_1D.csv",sep=''))%>% mutate(glacier="rink")
salt_surf_sver <- read.csv(paste(path,"salinity/sverdrup_salt_120m_1D.csv",sep=''))%>% mutate(glacier="sver")
salt_deep_sver <- read.csv(paste(path,"salinity/sverdrup_salt_220m_1D.csv",sep=''))%>% mutate(glacier="sver")
salt_surf<-rbind(salt_surf_fish,salt_surf_kong,salt_surf_rink,salt_surf_sver) %>% rename(salt_surf=salinity)
salt_deep<-rbind(salt_deep_fish,salt_deep_kong,salt_deep_rink,salt_deep_sver) %>% rename(salt_deep=salinity)
# temperature
temp_surf_fish <- read.csv(paste(path,"temperature/fisher_temp_120m_1D.csv",sep=''))%>% mutate(glacier="rink")
temp_deep_fish <- read.csv(paste(path,"temperature/fisher_temp_220m_1D.csv",sep=''))%>% mutate(glacier="rink")
temp_surf_kong <- read.csv(paste(path,"temperature/kongoscar_temp_120m_1D.csv",sep=''))%>% mutate(glacier="kong")
temp_deep_kong <- read.csv(paste(path,"temperature/kongoscar_temp_220m_1D.csv",sep=''))%>% mutate(glacier="kong")
temp_surf_rink <- read.csv(paste(path,"temperature/rink_temp_120m_1D.csv",sep=''))%>% mutate(glacier="rink")
temp_deep_rink <- read.csv(paste(path,"temperature/rink_temp_220m_1D.csv",sep=''))%>% mutate(glacier="rink")
temp_surf_sver <- read.csv(paste(path,"temperature/sverdrup_temp_120m_1D.csv",sep=''))%>% mutate(glacier="sver")
temp_deep_sver <- read.csv(paste(path,"temperature/sverdrup_temp_220m_1D.csv",sep=''))%>% mutate(glacier="sver")
temp_surf <- rbind(temp_surf_fish,temp_surf_kong,temp_surf_rink,temp_surf_sver) %>% rename(temp_surf=temperature)
temp_deep <- rbind(temp_deep_fish,temp_deep_kong,temp_deep_rink,temp_deep_sver) %>% rename(temp_deep=temperature)
# table of additional glacier variables
glacier_vars_df <- read.csv(paste(path,"narwhal_model_glacier_vars.csv",sep=''))
read.csv(paste(path,"narwhal_detections/Kong_Oscar_2018-2019_AuralM2_daily.csv",sep=''))%>% mutate(glacier="kong",device="aural")
?select
# narwhal detections
narwhal_kong_AU18 <- read.csv(paste(path,"narwhal_detections/Kong_Oscar_2018-2019_AuralM2_daily.csv",sep=''))%>% mutate(glacier="kong",device="aural") %>% dplyr::select(Time_UTC, narwhal,glacier,device)
# use this line to list all filenames in specified directory
# files = list.files(path='D:/Habitat_model_data/covariate_csv_files',pattern = '*.csv',recursive = TRUE)
# data stored on external harddrive -- update path here
path <- 'D:/Habitat_model_data/covariate_csv_files/'
## load all data from csv files and add columns to indicate glacier/site and device (where applicable)
## then join all data into one dataframe per variable
# narwhal detections
narwhal_kong_AU18 <- read.csv(paste(path,"narwhal_detections/Kong_Oscar_2018-2019_AuralM2_daily.csv",sep=''))%>% mutate(glacier="kong",device="aural") %>% dplyr::select(Time_UTC, narwhal,glacier,device)
narwhal_kong_AU19 <- read.csv(paste(path,"narwhal_detections/Nuussuaq_KongOscar_AuralM2_daily.csv",sep=''))%>% mutate(glacier="kong",device="aural")%>% dplyr::select(Time_UTC, narwhal,glacier,device)
narwhal_kong_ST19 <- read.csv(paste(path,"narwhal_detections/Nuussuaq_KongOscar_ST_daily.csv",sep=''))%>% mutate(glacier="kong",device="soundtrap")%>% dplyr::select(Time_UTC, narwhal,glacier,device)
narwhal_rink_AU18 <- read.csv(paste(path,"narwhal_detections/Rink_Glacier_2018-19_AuralM2_daily.csv",sep=''))%>% mutate(glacier="rink",device="aural")%>% dplyr::select(Time_UTC, narwhal,glacier,device)
narwhal_fish_AU19 <- read.csv(paste(path,"narwhal_detections/Rink_Glacier_Fischer_AuralM2_daily.csv",sep=''))%>% mutate(glacier="rink",device="aural")%>% dplyr::select(Time_UTC, narwhal,glacier,device)
narwhal_fish_ST19 <- read.csv(paste(path,"narwhal_detections/Rink_Glacier_Fischer_ST_daily.csv",sep=''))%>% mutate(glacier="rink",device="soundtrap")%>% dplyr::select(Time_UTC, narwhal,glacier,device)
narwhal_sver_AU18 <- read.csv(paste(path,"narwhal_detections/Sverdrup2018-19_AuralM2_daily.csv",sep=''))%>% mutate(glacier="sver",device="aural")%>% dplyr::select(Time_UTC, narwhal,glacier,device)
narwhal_dets <- rbind(narwhal_kong_AU18,
narwhal_kong_AU19,
narwhal_kong_ST19,
narwhal_rink_AU18,
narwhal_fish_AU19,
narwhal_fish_ST19,
narwhal_sver_AU18) %>%
mutate(time=as.character(strptime(as.Date(Time_UTC,format=c('%Y/%b/%d')),format='%Y-%m-%d'))) %>% dplyr::select(!Time_UTC)
# pool soundtrap and aural detections for 2019 data (i.e., take only one obs/day for each site)
narwhal_pooled <- narwhal_dets %>% group_by(glacier,time) %>%
filter(narwhal==max(narwhal),(row_number()==n()))
# ice velocity
kong_ice_vel <- read.csv(paste(path,"glacier_ice_velocity/kongoscar_ice_velocity_1D.csv",sep=''))%>% mutate(glacier="kong")
rink_ice_vel <- read.csv(paste(path,"glacier_ice_velocity/rink_ice_velocity_1D.csv",sep='')) %>% mutate(glacier="rink")
sver_ice_vel <- read.csv(paste(path,"glacier_ice_velocity/sverdrup_ice_velocity_1D.csv",sep='')) %>% mutate(glacier="sver")
ice_vel<-rbind(kong_ice_vel,rink_ice_vel,sver_ice_vel)
# glacier length (= terminus position)
kong_glacier_length <- read.csv(paste(path,"glacier_length/kongoscar_glacier_length_1D.csv",sep=''))%>% mutate(glacier="kong")
rink_glacier_length <- read.csv(paste(path,"glacier_length/rink_glacier_length_1D.csv",sep=''))%>% mutate(glacier="rink")
sver_glacier_length <- read.csv(paste(path,"glacier_length/sverdrup_glacier_length_1D.csv",sep=''))%>% mutate(glacier="sver")
glacier_len<-rbind(kong_glacier_length,rink_glacier_length,sver_glacier_length)
# runoff
runoff_kong <- read.csv(paste(path,"runoff/kongoscar_runoff_1D.csv",sep=''))%>% mutate(glacier="kong")
runoff_rink <- read.csv(paste(path,"runoff/rink_runoff_1D.csv",sep=''))%>% mutate(glacier="rink")
runoff_sver <- read.csv(paste(path,"runoff/sverdrup_runoff_1D.csv",sep=''))%>% mutate(glacier="sver")
runoff<-rbind(runoff_kong,runoff_rink,runoff_sver)
# sea ice
sea_ice_rink <- read.csv(paste(path,"sea_ice/fisher_seaice_cover_1D.csv",sep=''))%>% mutate(glacier="rink")
sea_ice_kong <- read.csv(paste(path,"sea_ice/kongoscar_seaice_cover_1D.csv",sep=''))%>% mutate(glacier="kong")
sea_ice_sver <- read.csv(paste(path,"sea_ice/sverdrup_seaice_cover_1D.csv",sep=''))%>% mutate(glacier="sver")
sea_ice<-rbind(sea_ice_rink,sea_ice_kong,sea_ice_sver)
# salinity
salt_surf_fish <- read.csv(paste(path,"salinity/fisher_salt_120m_1D.csv",sep=''))%>% mutate(glacier="rink")
salt_deep_fish <- read.csv(paste(path,"salinity/fisher_salt_220m_1D.csv",sep=''))%>% mutate(glacier="rink")
salt_surf_kong <- read.csv(paste(path,"salinity/kongoscar_salt_120m_1D.csv",sep=''))%>% mutate(glacier="kong") %>% mutate(time=as.character(as.Date(time,format='%m/%d/%Y')))
salt_deep_kong <- read.csv(paste(path,"salinity/kongoscar_salt_220m_1D.csv",sep=''))%>% mutate(glacier="kong")
salt_surf_rink <- read.csv(paste(path,"salinity/rink_salt_120m_1D.csv",sep=''))%>% mutate(glacier="rink")
salt_deep_rink <- read.csv(paste(path,"salinity/rink_salt_220m_1D.csv",sep=''))%>% mutate(glacier="rink")
salt_surf_sver <- read.csv(paste(path,"salinity/sverdrup_salt_120m_1D.csv",sep=''))%>% mutate(glacier="sver")
salt_deep_sver <- read.csv(paste(path,"salinity/sverdrup_salt_220m_1D.csv",sep=''))%>% mutate(glacier="sver")
salt_surf<-rbind(salt_surf_fish,salt_surf_kong,salt_surf_rink,salt_surf_sver) %>% rename(salt_surf=salinity)
salt_deep<-rbind(salt_deep_fish,salt_deep_kong,salt_deep_rink,salt_deep_sver) %>% rename(salt_deep=salinity)
# temperature
temp_surf_fish <- read.csv(paste(path,"temperature/fisher_temp_120m_1D.csv",sep=''))%>% mutate(glacier="rink")
temp_deep_fish <- read.csv(paste(path,"temperature/fisher_temp_220m_1D.csv",sep=''))%>% mutate(glacier="rink")
temp_surf_kong <- read.csv(paste(path,"temperature/kongoscar_temp_120m_1D.csv",sep=''))%>% mutate(glacier="kong")
temp_deep_kong <- read.csv(paste(path,"temperature/kongoscar_temp_220m_1D.csv",sep=''))%>% mutate(glacier="kong")
temp_surf_rink <- read.csv(paste(path,"temperature/rink_temp_120m_1D.csv",sep=''))%>% mutate(glacier="rink")
temp_deep_rink <- read.csv(paste(path,"temperature/rink_temp_220m_1D.csv",sep=''))%>% mutate(glacier="rink")
temp_surf_sver <- read.csv(paste(path,"temperature/sverdrup_temp_120m_1D.csv",sep=''))%>% mutate(glacier="sver")
temp_deep_sver <- read.csv(paste(path,"temperature/sverdrup_temp_220m_1D.csv",sep=''))%>% mutate(glacier="sver")
temp_surf <- rbind(temp_surf_fish,temp_surf_kong,temp_surf_rink,temp_surf_sver) %>% rename(temp_surf=temperature)
temp_deep <- rbind(temp_deep_fish,temp_deep_kong,temp_deep_rink,temp_deep_sver) %>% rename(temp_deep=temperature)
# table of additional glacier variables
glacier_vars_df <- read.csv(paste(path,"narwhal_model_glacier_vars.csv",sep=''))
## make data tidy and join all vars into one df
# ALL narwhal detections (aural + soundtrap)
model_vars_df <- runoff %>% left_join(salt_surf, by = c('time', 'glacier')) %>%
left_join(salt_deep, by = c('time', 'glacier')) %>%
left_join(temp_surf, by = c('time', 'glacier')) %>%
left_join(temp_deep, by = c('time', 'glacier')) %>%
left_join(sea_ice, by = c('time', 'glacier')) %>%
left_join(ice_vel, by = c('time', 'glacier')) %>%
left_join(glacier_len, by = c('time', 'glacier')) %>%
left_join(narwhal_dets, by = c('time', 'glacier')) %>%
mutate(DOY=as.numeric(strftime(as.Date(time),format='%j')),
year = strftime(as.Date(time),format='%Y'))
# pooled narwhal detections (i.e., any positive detection from Aural or ST = 1)
narwhal_pooled_dets <- narwhal_pooled %>% dplyr::select(narwhal, glacier, time)
model_vars_pooled_df <- runoff %>% left_join(salt_surf, by = c('time', 'glacier')) %>%
left_join(salt_deep, by = c('time', 'glacier')) %>%
left_join(temp_surf, by = c('time', 'glacier')) %>%
left_join(temp_deep, by = c('time', 'glacier')) %>%
left_join(sea_ice, by = c('time', 'glacier')) %>%
left_join(ice_vel, by = c('time', 'glacier')) %>%
left_join(glacier_len, by = c('time', 'glacier')) %>%
left_join(narwhal_pooled_dets, by = c('time', 'glacier')) %>%
mutate(DOY=as.numeric(strftime(as.Date(time),format='%j')),
year = strftime(as.Date(time),format='%Y'))
# check to make sure values are
model_vars_df %>% filter(time=='2019-09-30')
# do not scale data but ensure vars are numeric and drop na (=select complete observations)
model_data <- model_vars_df %>%
mutate_at(vars(runoff,salt_surf,temp_surf,salt_deep,temp_deep,ice_cover_percent,
velocity,glacier_length,DOY),as.numeric) %>%
drop_na()
model_data_pooled <- model_vars_pooled_df %>%
mutate_at(vars(runoff,salt_surf,temp_surf,salt_deep,temp_deep,ice_cover_percent,
velocity,glacier_length,DOY),as.numeric) %>%
drop_na()
# model with 'device' variable
mdl_global <- glm(narwhal ~
runoff+glacier+salt_surf+salt_deep+temp_surf+
temp_deep+ice_cover_percent+glacier_length+device+DOY,
data = model_data,family=binomial(link="logit"),na.action="na.fail")
# model without device (pooled detections)
mdl_global_pooled <- glm(narwhal ~
runoff+
glacier+
salt_surf+
salt_deep+
temp_surf+
temp_deep+
ice_cover_percent+
glacier_length+
DOY,
data = model_data_pooled,
family=binomial(link="logit"),na.action="na.fail")
summary(mdl_global_pooled)
faraway::sumary(mdl_global_pooled)
par(mfrow = c(2,2))
plot(mdl_global_pooled)
## use dredge function to run all model combinations ======================
dredge_mdl <- dredge(mdl_global_pooled)
dredge_mdl
mdl_ice <- glm(narwhal ~
ice_cover_percent,data = model_data_pooled,
family=binomial(link="logit"),na.action="na.fail")
mdl_ice <- glm(narwhal ~
temp_surf,data = model_data_pooled,
family=binomial(link="logit"),na.action="na.fail")
library(tidyverse)
library(corrplot)
library(MuMIn)
library(arm)
library(faraway)
# use this line to list all filenames in specified directory
# files = list.files(path='D:/Habitat_model_data/covariate_csv_files',pattern = '*.csv',recursive = TRUE)
# data stored on external harddrive -- update path here
path <- 'D:/Habitat_model_data/covariate_csv_files/'
## load all data from csv files and add columns to indicate glacier/site and device (where applicable)
## then join all data into one dataframe per variable
# narwhal detections
narwhal_kong_AU18 <- read.csv(paste(path,"narwhal_detections/Kong_Oscar_2018-2019_AuralM2_daily.csv",sep=''))%>% mutate(glacier="kong",device="aural") %>% dplyr::select(Time_UTC, narwhal,glacier,device)
narwhal_kong_AU19 <- read.csv(paste(path,"narwhal_detections/Nuussuaq_KongOscar_AuralM2_daily.csv",sep=''))%>% mutate(glacier="kong",device="aural")%>% dplyr::select(Time_UTC, narwhal,glacier,device)
narwhal_kong_ST19 <- read.csv(paste(path,"narwhal_detections/Nuussuaq_KongOscar_ST_daily.csv",sep=''))%>% mutate(glacier="kong",device="soundtrap")%>% dplyr::select(Time_UTC, narwhal,glacier,device)
narwhal_rink_AU18 <- read.csv(paste(path,"narwhal_detections/Rink_Glacier_2018-19_AuralM2_daily.csv",sep=''))%>% mutate(glacier="rink",device="aural")%>% dplyr::select(Time_UTC, narwhal,glacier,device)
narwhal_fish_AU19 <- read.csv(paste(path,"narwhal_detections/Rink_Glacier_Fischer_AuralM2_daily.csv",sep=''))%>% mutate(glacier="rink",device="aural")%>% dplyr::select(Time_UTC, narwhal,glacier,device)
narwhal_fish_ST19 <- read.csv(paste(path,"narwhal_detections/Rink_Glacier_Fischer_ST_daily.csv",sep=''))%>% mutate(glacier="rink",device="soundtrap")%>% dplyr::select(Time_UTC, narwhal,glacier,device)
narwhal_sver_AU18 <- read.csv(paste(path,"narwhal_detections/Sverdrup2018-19_AuralM2_daily.csv",sep=''))%>% mutate(glacier="sver",device="aural")%>% dplyr::select(Time_UTC, narwhal,glacier,device)
narwhal_dets <- rbind(narwhal_kong_AU18,
narwhal_kong_AU19,
narwhal_kong_ST19,
narwhal_rink_AU18,
narwhal_fish_AU19,
narwhal_fish_ST19,
narwhal_sver_AU18) %>%
mutate(time=as.character(strptime(as.Date(Time_UTC,format=c('%Y/%b/%d')),format='%Y-%m-%d'))) %>% dplyr::select(!Time_UTC)
# pool soundtrap and aural detections for 2019 data (i.e., take only one obs/day for each site)
narwhal_pooled <- narwhal_dets %>% group_by(glacier,time) %>%
filter(narwhal==max(narwhal),(row_number()==n()))
# ice velocity
kong_ice_vel <- read.csv(paste(path,"glacier_ice_velocity/kongoscar_ice_velocity_1D.csv",sep=''))%>% mutate(glacier="kong")
rink_ice_vel <- read.csv(paste(path,"glacier_ice_velocity/rink_ice_velocity_1D.csv",sep='')) %>% mutate(glacier="rink")
sver_ice_vel <- read.csv(paste(path,"glacier_ice_velocity/sverdrup_ice_velocity_1D.csv",sep='')) %>% mutate(glacier="sver")
ice_vel<-rbind(kong_ice_vel,rink_ice_vel,sver_ice_vel)
# glacier length (= terminus position)
kong_glacier_length <- read.csv(paste(path,"glacier_length/kongoscar_glacier_length_1D.csv",sep=''))%>% mutate(glacier="kong")
rink_glacier_length <- read.csv(paste(path,"glacier_length/rink_glacier_length_1D.csv",sep=''))%>% mutate(glacier="rink")
sver_glacier_length <- read.csv(paste(path,"glacier_length/sverdrup_glacier_length_1D.csv",sep=''))%>% mutate(glacier="sver")
glacier_len<-rbind(kong_glacier_length,rink_glacier_length,sver_glacier_length)
# runoff
runoff_kong <- read.csv(paste(path,"runoff/kongoscar_runoff_1D.csv",sep=''))%>% mutate(glacier="kong")
runoff_rink <- read.csv(paste(path,"runoff/rink_runoff_1D.csv",sep=''))%>% mutate(glacier="rink")
runoff_sver <- read.csv(paste(path,"runoff/sverdrup_runoff_1D.csv",sep=''))%>% mutate(glacier="sver")
runoff<-rbind(runoff_kong,runoff_rink,runoff_sver)
# sea ice
sea_ice_rink <- read.csv(paste(path,"sea_ice/fisher_seaice_cover_1D.csv",sep=''))%>% mutate(glacier="rink")
sea_ice_kong <- read.csv(paste(path,"sea_ice/kongoscar_seaice_cover_1D.csv",sep=''))%>% mutate(glacier="kong")
sea_ice_sver <- read.csv(paste(path,"sea_ice/sverdrup_seaice_cover_1D.csv",sep=''))%>% mutate(glacier="sver")
sea_ice<-rbind(sea_ice_rink,sea_ice_kong,sea_ice_sver)
# salinity
salt_surf_fish <- read.csv(paste(path,"salinity/fisher_salt_120m_1D.csv",sep=''))%>% mutate(glacier="rink")
salt_deep_fish <- read.csv(paste(path,"salinity/fisher_salt_220m_1D.csv",sep=''))%>% mutate(glacier="rink")
salt_surf_kong <- read.csv(paste(path,"salinity/kongoscar_salt_120m_1D.csv",sep=''))%>% mutate(glacier="kong") %>% mutate(time=as.character(as.Date(time,format='%m/%d/%Y')))
salt_deep_kong <- read.csv(paste(path,"salinity/kongoscar_salt_220m_1D.csv",sep=''))%>% mutate(glacier="kong")
salt_surf_rink <- read.csv(paste(path,"salinity/rink_salt_120m_1D.csv",sep=''))%>% mutate(glacier="rink")
salt_deep_rink <- read.csv(paste(path,"salinity/rink_salt_220m_1D.csv",sep=''))%>% mutate(glacier="rink")
salt_surf_sver <- read.csv(paste(path,"salinity/sverdrup_salt_120m_1D.csv",sep=''))%>% mutate(glacier="sver")
salt_deep_sver <- read.csv(paste(path,"salinity/sverdrup_salt_220m_1D.csv",sep=''))%>% mutate(glacier="sver")
salt_surf<-rbind(salt_surf_fish,salt_surf_kong,salt_surf_rink,salt_surf_sver) %>% rename(salt_surf=salinity)
salt_deep<-rbind(salt_deep_fish,salt_deep_kong,salt_deep_rink,salt_deep_sver) %>% rename(salt_deep=salinity)
# temperature
temp_surf_fish <- read.csv(paste(path,"temperature/fisher_temp_120m_1D.csv",sep=''))%>% mutate(glacier="rink")
temp_deep_fish <- read.csv(paste(path,"temperature/fisher_temp_220m_1D.csv",sep=''))%>% mutate(glacier="rink")
temp_surf_kong <- read.csv(paste(path,"temperature/kongoscar_temp_120m_1D.csv",sep=''))%>% mutate(glacier="kong")
temp_deep_kong <- read.csv(paste(path,"temperature/kongoscar_temp_220m_1D.csv",sep=''))%>% mutate(glacier="kong")
temp_surf_rink <- read.csv(paste(path,"temperature/rink_temp_120m_1D.csv",sep=''))%>% mutate(glacier="rink")
temp_deep_rink <- read.csv(paste(path,"temperature/rink_temp_220m_1D.csv",sep=''))%>% mutate(glacier="rink")
temp_surf_sver <- read.csv(paste(path,"temperature/sverdrup_temp_120m_1D.csv",sep=''))%>% mutate(glacier="sver")
temp_deep_sver <- read.csv(paste(path,"temperature/sverdrup_temp_220m_1D.csv",sep=''))%>% mutate(glacier="sver")
temp_surf <- rbind(temp_surf_fish,temp_surf_kong,temp_surf_rink,temp_surf_sver) %>% rename(temp_surf=temperature)
temp_deep <- rbind(temp_deep_fish,temp_deep_kong,temp_deep_rink,temp_deep_sver) %>% rename(temp_deep=temperature)
# table of additional glacier variables
glacier_vars_df <- read.csv(paste(path,"narwhal_model_glacier_vars.csv",sep=''))
## make data tidy and join all vars into one df
# ALL narwhal detections (aural + soundtrap)
model_vars_df <- runoff %>% left_join(salt_surf, by = c('time', 'glacier')) %>%
left_join(salt_deep, by = c('time', 'glacier')) %>%
left_join(temp_surf, by = c('time', 'glacier')) %>%
left_join(temp_deep, by = c('time', 'glacier')) %>%
left_join(sea_ice, by = c('time', 'glacier')) %>%
left_join(ice_vel, by = c('time', 'glacier')) %>%
left_join(glacier_len, by = c('time', 'glacier')) %>%
left_join(narwhal_dets, by = c('time', 'glacier')) %>%
mutate(DOY=as.numeric(strftime(as.Date(time),format='%j')),
year = strftime(as.Date(time),format='%Y'))
# pooled narwhal detections (i.e., any positive detection from Aural or ST = 1)
narwhal_pooled_dets <- narwhal_pooled %>% dplyr::select(narwhal, glacier, time)
model_vars_pooled_df <- runoff %>% left_join(salt_surf, by = c('time', 'glacier')) %>%
left_join(salt_deep, by = c('time', 'glacier')) %>%
left_join(temp_surf, by = c('time', 'glacier')) %>%
left_join(temp_deep, by = c('time', 'glacier')) %>%
left_join(sea_ice, by = c('time', 'glacier')) %>%
left_join(ice_vel, by = c('time', 'glacier')) %>%
left_join(glacier_len, by = c('time', 'glacier')) %>%
left_join(narwhal_pooled_dets, by = c('time', 'glacier')) %>%
mutate(DOY=as.numeric(strftime(as.Date(time),format='%j')),
year = strftime(as.Date(time),format='%Y'))
# ensure vars are numeric and drop na (=select complete observations)
model_data <- model_vars_df %>%
mutate_at(vars(runoff,salt_surf,temp_surf,salt_deep,temp_deep,ice_cover_percent,
velocity,glacier_length,DOY),as.numeric) %>%
drop_na()
model_data_pooled <- model_vars_pooled_df %>%
mutate_at(vars(runoff,salt_surf,temp_surf,salt_deep,temp_deep,ice_cover_percent,
velocity,glacier_length,DOY),as.numeric) %>%
drop_na()
# model with 'device' variable
mdl_global <- glm(narwhal ~
runoff+glacier+salt_surf+salt_deep+temp_surf+
temp_deep+ice_cover_percent+glacier_length+device+DOY,
data = model_data,family=binomial(link="logit"),na.action="na.fail")
# model without device (pooled detections)
mdl_global_pooled <- glm(narwhal ~
runoff+
glacier+
salt_surf+
salt_deep+
temp_surf+
temp_deep+
ice_cover_percent+
glacier_length+
DOY,
data = model_data_pooled,
family=binomial(link="logit"),na.action="na.fail")
# model with 'device' variable
mdl_global <- glm(narwhal ~
runoff+
glacier+
salt_surf+
salt_deep+
temp_surf+
temp_deep+
ice_cover_percent+
glacier_length+
device
data = model_data,family=binomial(link="logit"),na.action="na.fail")
# model with 'device' variable
mdl_global <- glm(narwhal ~
runoff+
glacier+
salt_surf+
salt_deep+
temp_surf+
temp_deep+
ice_cover_percent+
glacier_length+
device,
data = model_data,family=binomial(link="logit"),na.action="na.fail")
# model without device (pooled detections)
mdl_global_pooled <- glm(narwhal ~
runoff+
glacier+
salt_surf+
salt_deep+
temp_surf+
temp_deep+
ice_cover_percent+
glacier_length+
DOY,
data = model_data_pooled,
family=binomial(link="logit"),na.action="na.fail")
# model without device (pooled detections)
mdl_global_pooled <- glm(narwhal ~
runoff+
glacier+
salt_surf+
salt_deep+
temp_surf+
temp_deep+
glacier_length+
DOY,
data = model_data_pooled,
family=binomial(link="logit"),na.action="na.fail")
# model without device (pooled detections)
mdl_global_pooled <- glm(narwhal ~
glacier+
salt_surf+
salt_deep+
temp_surf+
temp_deep+
ice_cover_percent+
glacier_length+
DOY,
data = model_data_pooled,
family=binomial(link="logit"),na.action="na.fail")
# model with 'device' variable
mdl_global <- glm(narwhal ~
runoff+
glacier+
salt_surf+
salt_deep+
temp_surf+
temp_deep+
glacier_length+
device+
DOY,
data = model_data,family=binomial(link="logit"),na.action="na.fail")
