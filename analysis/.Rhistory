# run correlation test
corrplot(model_vars_num, method = 'number')
# run correlation test
corrplot::corrplot(model_vars_num, method = 'number')
# ensure vars are numeric and drop na (=select complete observations)
model_data <- model_vars_df %>%
mutate_at(vars(runoff,salt_surf,temp_surf,salt_deep,temp_deep,ice_cover_percent,
velocity,glacier_length,DOY),as.numeric) %>%
drop_na()
model_data_pooled <- model_vars_pooled_df %>%
mutate_at(vars(runoff,salt_surf,temp_surf,salt_deep,temp_deep,ice_cover_percent,
velocity,glacier_length,DOY),as.numeric) %>%
drop_na()
## since we know narwhals cannot survive in Melville Bay after the freeze up, we will select data from before the fast ice comes in
## here, I define the freeze up date as the day when sea ice > 75%
## freeze up date in 2018
head(model_data_pooled %>% dplyr::filter(ice_cover_percent>75,year==2018))
# 2018-10-28 which is equal to DOY=301 # sverdrup froze up first
## freeze up date in 2019
model_data_pooled %>% dplyr::filter(ice_cover_percent>75,year==2019,DOY>100)
# 2019-12-23 which is equal to DOY=357 # rink froze up first
## filter all data before these dates
mdl_data_open_water2018 <- model_data_pooled %>% filter(year==2018) %>%
filter(DOY<301)
mdl_data_open_water2019 <- model_data_pooled %>% filter(year==2019) %>%
filter(DOY>100,DOY<357)
# sanity check plots
qplot(as.Date(time),ice_cover_percent, geom="point", data = mdl_data_open_water2018)
qplot(as.Date(time),ice_cover_percent, geom="point", data = mdl_data_open_water2019)
## join both datasets
mdl_data_b4freeze_pooled <- rbind(mdl_data_open_water2018, mdl_data_open_water2019)
qplot(as.Date(time),ice_cover_percent, geom="point", data = mdl_data_b4freeze_pooled)
## Rink/Fisher ---------------------------------------------
mdl_data_rink <- mdl_data_b4freeze_pooled %>% filter(site=='rink')
mdl_rink <- glm(narwhal ~ temp_surf+temp_deep+salt_surf+salt_deep+
ice_cover_percent+runoff+glacier_length+DOY,
data = mdl_data_rink,family=binomial(link="logit"),na.action="na.fail")
View(mdl_data_rink)
mdl_rink <- glm(narwhal ~ temp_surf+temp_deep+salt_surf+salt_deep+
runoff+glacier_length+DOY,
data = mdl_data_rink,family=binomial(link="logit"),na.action="na.fail")
summary(mdl_rink)
mdl_rink <- glm(narwhal ~ temp_surf+temp_deep+salt_surf+salt_deep+
ice_cover_percent+runoff+glacier_length+DOY,
data = mdl_data_rink,family=binomial(link="logit"),na.action="na.fail")
summary(mdl_rink)
## Kong Oscar ----------------------------------------------
mdl_data_kong <- mdl_data_b4freeze_pooled %>% filter(site=='kong')
mdl_kong <- glm(narwhal ~ temp_surf+temp_deep+salt_surf+salt_deep+
ice_cover_percent+runoff+glacier_length+DOY,
data = mdl_data_kong,family=binomial(link="logit"),na.action="na.fail")
summary(mdl_kong)
## Sverdrup ------------------------------------------------
mdl_data_sver <- mdl_data_b4freeze_pooled %>% filter(site=='sver')
mdl_sver <- glm(narwhal ~ temp_surf+temp_deep+salt_surf+salt_deep+
ice_cover_percent+runoff+glacier_length+DOY,
data = mdl_data_sver,family=binomial(link="logit"),na.action="na.fail")
summary(mdl_sver)
# use this line to list all filenames in specified directory
# files = list.files(path='D:/Habitat_model_data/covariate_csv_files',pattern = '*.csv',recursive = TRUE)
# data stored on external harddrive -- update path here
path <- 'D:/Habitat_model_data/covariate_csv_files/'
## load all data from csv files and add columns to indicate glacier/site and device (where applicable)
## then join all data into one dataframe per variable
# narwhal detections
narwhal_kong_AU18 <- read.csv(paste(path,"narwhal_detections/Kong_Oscar_2018-2019_AuralM2_daily.csv",sep=''))%>% mutate(site="kong",device="aural") %>% dplyr::select(Time_UTC, narwhal,site,device)
narwhal_kong_AU19 <- read.csv(paste(path,"narwhal_detections/Nuussuaq_KongOscar_AuralM2_daily.csv",sep=''))%>% mutate(site="kong",device="aural")%>% dplyr::select(Time_UTC, narwhal,site,device)
narwhal_kong_ST19 <- read.csv(paste(path,"narwhal_detections/Nuussuaq_KongOscar_ST_daily.csv",sep=''))%>% mutate(site="kong",device="soundtrap")%>% dplyr::select(Time_UTC, narwhal,site,device)
narwhal_rink_AU18 <- read.csv(paste(path,"narwhal_detections/Rink_Glacier_2018-19_AuralM2_daily.csv",sep=''))%>% mutate(site="rink",device="aural")%>% dplyr::select(Time_UTC, narwhal,site,device)
narwhal_fish_AU19 <- read.csv(paste(path,"narwhal_detections/Rink_Glacier_Fischer_AuralM2_daily.csv",sep=''))%>% mutate(site="rink",device="aural")%>% dplyr::select(Time_UTC, narwhal,site,device)
narwhal_fish_ST19 <- read.csv(paste(path,"narwhal_detections/Rink_Glacier_Fischer_ST_daily.csv",sep=''))%>% mutate(site="rink",device="soundtrap")%>% dplyr::select(Time_UTC, narwhal,site,device)
narwhal_sver_AU18 <- read.csv(paste(path,"narwhal_detections/Sverdrup2018-19_AuralM2_daily.csv",sep=''))%>% mutate(site="sver",device="aural")%>% dplyr::select(Time_UTC, narwhal,site,device)
narwhal_dets <- rbind(narwhal_kong_AU18,
narwhal_kong_AU19,
narwhal_kong_ST19,
narwhal_rink_AU18,
narwhal_fish_AU19,
narwhal_fish_ST19,
narwhal_sver_AU18) %>%
mutate(time=as.character(strptime(as.Date(Time_UTC,format=c('%Y/%b/%d')),format='%Y-%m-%d'))) %>% dplyr::select(!Time_UTC)
# pool soundtrap and aural detections for 2019 data (i.e., take only one obs/day for each site)
narwhal_pooled <- narwhal_dets %>% group_by(site,time) %>%
filter(narwhal==max(narwhal),(row_number()==n()))
# ice velocity
kong_ice_vel <- read.csv(paste(path,"glacier_ice_velocity/kongoscar_ice_velocity_1D.csv",sep=''))%>% mutate(site="kong")
rink_ice_vel <- read.csv(paste(path,"glacier_ice_velocity/rink_ice_velocity_1D.csv",sep='')) %>% mutate(site="rink")
sver_ice_vel <- read.csv(paste(path,"glacier_ice_velocity/sverdrup_ice_velocity_1D.csv",sep='')) %>% mutate(site="sver")
ice_vel<-rbind(kong_ice_vel,rink_ice_vel,sver_ice_vel)
# glacier length (= terminus position)
kong_glacier_length <- read.csv(paste(path,"glacier_length/kongoscar_glacier_length_1D.csv",sep=''))%>% mutate(site="kong")
rink_glacier_length <- read.csv(paste(path,"glacier_length/rink_glacier_length_1D.csv",sep=''))%>% mutate(site="rink")
sver_glacier_length <- read.csv(paste(path,"glacier_length/sverdrup_glacier_length_1D.csv",sep=''))%>% mutate(site="sver")
glacier_len<-rbind(kong_glacier_length,rink_glacier_length,sver_glacier_length)
# runoff
# MAR
runoff_mar_kong <- read.csv(paste(path,"runoff/kongoscar_runoff_mar_1D.csv",sep=''))%>% mutate(site="kong")
runoff_mar_rink <- read.csv(paste(path,"runoff/rink_runoff_mar_1D.csv",sep=''))%>% mutate(site="rink")
runoff_mar_sver <- read.csv(paste(path,"runoff/sverdrup_runoff_mar_1D.csv",sep=''))%>% mutate(site="sver")
runoff_mar <- rbind(runoff_mar_kong,runoff_mar_rink,runoff_mar_sver)
# RACMO
runoff_racmo_kong <- read.csv(paste(path,"runoff/kongoscar_runoff_racmo_1D.csv",sep=''))%>%
mutate(site="kong")
runoff_racmo_rink <- read.csv(paste(path,"runoff/rink_runoff_racmo_1D.csv",sep=''))%>%
mutate(site="rink")
runoff_racmo_sver <- read.csv(paste(path,"runoff/sverdrup_runoff_racmo_1D.csv",sep=''))%>%
mutate(site="sver")
runoff_racmo <- rbind(runoff_racmo_kong,runoff_racmo_rink,runoff_racmo_sver)
# sea ice
sea_ice_rink <- read.csv(paste(path,"sea_ice/fisher_seaice_cover_1D.csv",sep=''))%>% mutate(site="rink")
sea_ice_kong <- read.csv(paste(path,"sea_ice/kongoscar_seaice_cover_1D.csv",sep=''))%>% mutate(site="kong")
sea_ice_sver <- read.csv(paste(path,"sea_ice/sverdrup_seaice_cover_1D.csv",sep=''))%>% mutate(site="sver")
sea_ice<-rbind(sea_ice_rink,sea_ice_kong,sea_ice_sver)
# salinity
salt_surf_fish <- read.csv(paste(path,"salinity/fisher_salt_120m_1D.csv",sep=''))%>% mutate(site="rink")
salt_deep_fish <- read.csv(paste(path,"salinity/fisher_salt_220m_1D.csv",sep=''))%>% mutate(site="rink")
salt_surf_kong <- read.csv(paste(path,"salinity/kongoscar_salt_120m_1D.csv",sep=''))%>% mutate(site="kong") %>% mutate(time=as.character(as.Date(time,format='%m/%d/%Y')))
salt_deep_kong <- read.csv(paste(path,"salinity/kongoscar_salt_220m_1D.csv",sep=''))%>% mutate(site="kong")
salt_surf_rink <- read.csv(paste(path,"salinity/rink_salt_120m_1D.csv",sep=''))%>% mutate(site="rink")
salt_deep_rink <- read.csv(paste(path,"salinity/rink_salt_220m_1D.csv",sep=''))%>% mutate(site="rink")
salt_surf_sver <- read.csv(paste(path,"salinity/sverdrup_salt_120m_1D.csv",sep=''))%>% mutate(site="sver")
salt_deep_sver <- read.csv(paste(path,"salinity/sverdrup_salt_220m_1D.csv",sep=''))%>% mutate(site="sver")
salt_surf<-rbind(salt_surf_fish,salt_surf_kong,salt_surf_rink,salt_surf_sver) %>% rename(salt_surf=salinity)
salt_deep<-rbind(salt_deep_fish,salt_deep_kong,salt_deep_rink,salt_deep_sver) %>% rename(salt_deep=salinity)
# temperature
temp_surf_fish <- read.csv(paste(path,"temperature/fisher_temp_120m_1D.csv",sep=''))%>% mutate(site="rink")
temp_deep_fish <- read.csv(paste(path,"temperature/fisher_temp_220m_1D.csv",sep=''))%>% mutate(site="rink")
temp_surf_kong <- read.csv(paste(path,"temperature/kongoscar_temp_120m_1D.csv",sep=''))%>% mutate(site="kong")
temp_deep_kong <- read.csv(paste(path,"temperature/kongoscar_temp_220m_1D.csv",sep=''))%>% mutate(site="kong")
temp_surf_rink <- read.csv(paste(path,"temperature/rink_temp_120m_1D.csv",sep=''))%>% mutate(site="rink")
temp_deep_rink <- read.csv(paste(path,"temperature/rink_temp_220m_1D.csv",sep=''))%>% mutate(site="rink")
temp_surf_sver <- read.csv(paste(path,"temperature/sverdrup_temp_120m_1D.csv",sep=''))%>% mutate(site="sver")
temp_deep_sver <- read.csv(paste(path,"temperature/sverdrup_temp_220m_1D.csv",sep=''))%>% mutate(site="sver")
temp_surf <- rbind(temp_surf_fish,temp_surf_kong,temp_surf_rink,temp_surf_sver) %>% rename(temp_surf=temperature)
temp_deep <- rbind(temp_deep_fish,temp_deep_kong,temp_deep_rink,temp_deep_sver) %>% rename(temp_deep=temperature)
# table of additional glacier variables
glacier_vars_df <- read.csv(paste(path,"narwhal_model_glacier_vars.csv",sep=''))
library(tidyverse)
library(corrplot)
library(MuMIn)
library(arm)
library(faraway)
library(ggplot2)
library(sjPlot)
# use this line to list all filenames in specified directory
# files = list.files(path='D:/Habitat_model_data/covariate_csv_files',pattern = '*.csv',recursive = TRUE)
# data stored on external harddrive -- update path here
path <- 'D:/Habitat_model_data/covariate_csv_files/'
## load all data from csv files and add columns to indicate glacier/site and device (where applicable)
## then join all data into one dataframe per variable
# narwhal detections
narwhal_kong_AU18 <- read.csv(paste(path,"narwhal_detections/Kong_Oscar_2018-2019_AuralM2_daily.csv",sep=''))%>% mutate(site="kong",device="aural") %>% dplyr::select(Time_UTC, narwhal,site,device)
narwhal_kong_AU19 <- read.csv(paste(path,"narwhal_detections/Nuussuaq_KongOscar_AuralM2_daily.csv",sep=''))%>% mutate(site="kong",device="aural")%>% dplyr::select(Time_UTC, narwhal,site,device)
narwhal_kong_ST19 <- read.csv(paste(path,"narwhal_detections/Nuussuaq_KongOscar_ST_daily.csv",sep=''))%>% mutate(site="kong",device="soundtrap")%>% dplyr::select(Time_UTC, narwhal,site,device)
narwhal_rink_AU18 <- read.csv(paste(path,"narwhal_detections/Rink_Glacier_2018-19_AuralM2_daily.csv",sep=''))%>% mutate(site="rink",device="aural")%>% dplyr::select(Time_UTC, narwhal,site,device)
narwhal_fish_AU19 <- read.csv(paste(path,"narwhal_detections/Rink_Glacier_Fischer_AuralM2_daily.csv",sep=''))%>% mutate(site="rink",device="aural")%>% dplyr::select(Time_UTC, narwhal,site,device)
narwhal_fish_ST19 <- read.csv(paste(path,"narwhal_detections/Rink_Glacier_Fischer_ST_daily.csv",sep=''))%>% mutate(site="rink",device="soundtrap")%>% dplyr::select(Time_UTC, narwhal,site,device)
narwhal_sver_AU18 <- read.csv(paste(path,"narwhal_detections/Sverdrup2018-19_AuralM2_daily.csv",sep=''))%>% mutate(site="sver",device="aural")%>% dplyr::select(Time_UTC, narwhal,site,device)
narwhal_dets <- rbind(narwhal_kong_AU18,
narwhal_kong_AU19,
narwhal_kong_ST19,
narwhal_rink_AU18,
narwhal_fish_AU19,
narwhal_fish_ST19,
narwhal_sver_AU18) %>%
mutate(time=as.character(strptime(as.Date(Time_UTC,format=c('%Y/%b/%d')),format='%Y-%m-%d'))) %>% dplyr::select(!Time_UTC)
# pool soundtrap and aural detections for 2019 data (i.e., take only one obs/day for each site)
narwhal_pooled <- narwhal_dets %>% group_by(site,time) %>%
filter(narwhal==max(narwhal),(row_number()==n()))
# ice velocity
kong_ice_vel <- read.csv(paste(path,"glacier_ice_velocity/kongoscar_ice_velocity_1D.csv",sep=''))%>% mutate(site="kong")
rink_ice_vel <- read.csv(paste(path,"glacier_ice_velocity/rink_ice_velocity_1D.csv",sep='')) %>% mutate(site="rink")
sver_ice_vel <- read.csv(paste(path,"glacier_ice_velocity/sverdrup_ice_velocity_1D.csv",sep='')) %>% mutate(site="sver")
ice_vel<-rbind(kong_ice_vel,rink_ice_vel,sver_ice_vel)
# glacier length (= terminus position)
kong_glacier_length <- read.csv(paste(path,"glacier_length/kongoscar_glacier_length_1D.csv",sep=''))%>% mutate(site="kong")
rink_glacier_length <- read.csv(paste(path,"glacier_length/rink_glacier_length_1D.csv",sep=''))%>% mutate(site="rink")
sver_glacier_length <- read.csv(paste(path,"glacier_length/sverdrup_glacier_length_1D.csv",sep=''))%>% mutate(site="sver")
glacier_len<-rbind(kong_glacier_length,rink_glacier_length,sver_glacier_length)
# runoff
# MAR
runoff_mar_kong <- read.csv(paste(path,"runoff/kongoscar_runoff_mar_1D.csv",sep=''))%>% mutate(site="kong")
runoff_mar_rink <- read.csv(paste(path,"runoff/rink_runoff_mar_1D.csv",sep=''))%>% mutate(site="rink")
runoff_mar_sver <- read.csv(paste(path,"runoff/sverdrup_runoff_mar_1D.csv",sep=''))%>% mutate(site="sver")
runoff_mar <- rbind(runoff_mar_kong,runoff_mar_rink,runoff_mar_sver)
# RACMO
runoff_racmo_kong <- read.csv(paste(path,"runoff/kongoscar_runoff_racmo_1D.csv",sep=''))%>%
mutate(site="kong")
runoff_racmo_rink <- read.csv(paste(path,"runoff/rink_runoff_racmo_1D.csv",sep=''))%>%
mutate(site="rink")
runoff_racmo_sver <- read.csv(paste(path,"runoff/sverdrup_runoff_racmo_1D.csv",sep=''))%>%
mutate(site="sver")
runoff_racmo <- rbind(runoff_racmo_kong,runoff_racmo_rink,runoff_racmo_sver)
# sea ice
sea_ice_rink <- read.csv(paste(path,"sea_ice/fisher_seaice_cover_1D.csv",sep=''))%>% mutate(site="rink")
sea_ice_kong <- read.csv(paste(path,"sea_ice/kongoscar_seaice_cover_1D.csv",sep=''))%>% mutate(site="kong")
sea_ice_sver <- read.csv(paste(path,"sea_ice/sverdrup_seaice_cover_1D.csv",sep=''))%>% mutate(site="sver")
sea_ice<-rbind(sea_ice_rink,sea_ice_kong,sea_ice_sver)
# salinity
salt_surf_fish <- read.csv(paste(path,"salinity/fisher_salt_120m_1D.csv",sep=''))%>% mutate(site="rink")
salt_deep_fish <- read.csv(paste(path,"salinity/fisher_salt_220m_1D.csv",sep=''))%>% mutate(site="rink")
salt_surf_kong <- read.csv(paste(path,"salinity/kongoscar_salt_120m_1D.csv",sep=''))%>% mutate(site="kong") %>% mutate(time=as.character(as.Date(time,format='%m/%d/%Y')))
salt_deep_kong <- read.csv(paste(path,"salinity/kongoscar_salt_220m_1D.csv",sep=''))%>% mutate(site="kong")
salt_surf_rink <- read.csv(paste(path,"salinity/rink_salt_120m_1D.csv",sep=''))%>% mutate(site="rink")
salt_deep_rink <- read.csv(paste(path,"salinity/rink_salt_220m_1D.csv",sep=''))%>% mutate(site="rink")
salt_surf_sver <- read.csv(paste(path,"salinity/sverdrup_salt_120m_1D.csv",sep=''))%>% mutate(site="sver")
salt_deep_sver <- read.csv(paste(path,"salinity/sverdrup_salt_220m_1D.csv",sep=''))%>% mutate(site="sver")
salt_surf<-rbind(salt_surf_fish,salt_surf_kong,salt_surf_rink,salt_surf_sver) %>% rename(salt_surf=salinity)
salt_deep<-rbind(salt_deep_fish,salt_deep_kong,salt_deep_rink,salt_deep_sver) %>% rename(salt_deep=salinity)
# temperature
temp_surf_fish <- read.csv(paste(path,"temperature/fisher_temp_120m_1D.csv",sep=''))%>% mutate(site="rink")
temp_deep_fish <- read.csv(paste(path,"temperature/fisher_temp_220m_1D.csv",sep=''))%>% mutate(site="rink")
temp_surf_kong <- read.csv(paste(path,"temperature/kongoscar_temp_120m_1D.csv",sep=''))%>% mutate(site="kong")
temp_deep_kong <- read.csv(paste(path,"temperature/kongoscar_temp_220m_1D.csv",sep=''))%>% mutate(site="kong")
temp_surf_rink <- read.csv(paste(path,"temperature/rink_temp_120m_1D.csv",sep=''))%>% mutate(site="rink")
temp_deep_rink <- read.csv(paste(path,"temperature/rink_temp_220m_1D.csv",sep=''))%>% mutate(site="rink")
temp_surf_sver <- read.csv(paste(path,"temperature/sverdrup_temp_120m_1D.csv",sep=''))%>% mutate(site="sver")
temp_deep_sver <- read.csv(paste(path,"temperature/sverdrup_temp_220m_1D.csv",sep=''))%>% mutate(site="sver")
temp_surf <- rbind(temp_surf_fish,temp_surf_kong,temp_surf_rink,temp_surf_sver) %>% rename(temp_surf=temperature)
temp_deep <- rbind(temp_deep_fish,temp_deep_kong,temp_deep_rink,temp_deep_sver) %>% rename(temp_deep=temperature)
# table of additional glacier variables
glacier_vars_df <- read.csv(paste(path,"narwhal_model_glacier_vars.csv",sep=''))
## make data tidy and join all vars into one df
# ALL narwhal detections (aural + soundtrap)
model_vars_df <- runoff %>% left_join(salt_surf, by = c('time', 'site')) %>%
left_join(salt_deep, by = c('time', 'site')) %>%
left_join(temp_surf, by = c('time', 'site')) %>%
left_join(temp_deep, by = c('time', 'site')) %>%
left_join(sea_ice, by = c('time', 'site')) %>%
left_join(ice_vel, by = c('time', 'site')) %>%
left_join(glacier_len, by = c('time', 'site')) %>%
left_join(narwhal_dets, by = c('time', 'site')) %>%
mutate(DOY=as.numeric(strftime(as.Date(time),format='%j')),
year = strftime(as.Date(time),format='%Y'))
# pooled narwhal detections (i.e., any positive detection from Aural or ST = 1)
narwhal_pooled_dets <- narwhal_pooled %>% dplyr::select(narwhal, site, time)
model_vars_pooled_df <- runoff %>% left_join(salt_surf, by = c('time', 'site')) %>%
left_join(salt_deep, by = c('time', 'site')) %>%
left_join(temp_surf, by = c('time', 'site')) %>%
left_join(temp_deep, by = c('time', 'site')) %>%
left_join(sea_ice, by = c('time', 'site')) %>%
left_join(ice_vel, by = c('time', 'site')) %>%
left_join(glacier_len, by = c('time', 'site')) %>%
left_join(narwhal_pooled_dets, by = c('time', 'site')) %>%
mutate(DOY=as.numeric(strftime(as.Date(time),format='%j')),
year = strftime(as.Date(time),format='%Y'))
## make data tidy and join all vars into one df
# ALL narwhal detections (aural + soundtrap)
model_vars_df <- runoff_racmo %>%
left_join(runoff_mar, by = c('time', 'site')) %>%
left_join(salt_surf, by = c('time', 'site')) %>%
left_join(salt_deep, by = c('time', 'site')) %>%
left_join(temp_surf, by = c('time', 'site')) %>%
left_join(temp_deep, by = c('time', 'site')) %>%
left_join(sea_ice, by = c('time', 'site')) %>%
left_join(ice_vel, by = c('time', 'site')) %>%
left_join(glacier_len, by = c('time', 'site')) %>%
left_join(narwhal_dets, by = c('time', 'site')) %>%
mutate(DOY=as.numeric(strftime(as.Date(time),format='%j')),
year = strftime(as.Date(time),format='%Y'))
# pooled narwhal detections (i.e., any positive detection from Aural or ST = 1)
narwhal_pooled_dets <- narwhal_pooled %>% dplyr::select(narwhal, site, time)
model_vars_pooled_df <- runoff_racmo %>%
left_join(runoff_mar, by = c('time', 'site')) %>%
left_join(salt_surf, by = c('time', 'site')) %>%
left_join(salt_deep, by = c('time', 'site')) %>%
left_join(temp_surf, by = c('time', 'site')) %>%
left_join(temp_deep, by = c('time', 'site')) %>%
left_join(sea_ice, by = c('time', 'site')) %>%
left_join(ice_vel, by = c('time', 'site')) %>%
left_join(glacier_len, by = c('time', 'site')) %>%
left_join(narwhal_pooled_dets, by = c('time', 'site')) %>%
mutate(DOY=as.numeric(strftime(as.Date(time),format='%j')),
year = strftime(as.Date(time),format='%Y'))
# check to make sure values are
model_vars_df %>% filter(time=='2019-09-30')
View(model_vars_pooled_df)
runoff_racmo
runoff_racmo <- rbind(runoff_racmo_kong,runoff_racmo_rink,runoff_racmo_sver) %>%
rename(runoff_racmo=runoff)
runoff_racmo
runoff_mar <- rbind(runoff_mar_kong,runoff_mar_rink,runoff_mar_sver) %>%
rename(runoff_mar=runoff)
# use this line to list all filenames in specified directory
# files = list.files(path='D:/Habitat_model_data/covariate_csv_files',pattern = '*.csv',recursive = TRUE)
# data stored on external harddrive -- update path here
path <- 'D:/Habitat_model_data/covariate_csv_files/'
## load all data from csv files and add columns to indicate glacier/site and device (where applicable)
## then join all data into one dataframe per variable
# narwhal detections
narwhal_kong_AU18 <- read.csv(paste(path,"narwhal_detections/Kong_Oscar_2018-2019_AuralM2_daily.csv",sep=''))%>% mutate(site="kong",device="aural") %>% dplyr::select(Time_UTC, narwhal,site,device)
narwhal_kong_AU19 <- read.csv(paste(path,"narwhal_detections/Nuussuaq_KongOscar_AuralM2_daily.csv",sep=''))%>% mutate(site="kong",device="aural")%>% dplyr::select(Time_UTC, narwhal,site,device)
narwhal_kong_ST19 <- read.csv(paste(path,"narwhal_detections/Nuussuaq_KongOscar_ST_daily.csv",sep=''))%>% mutate(site="kong",device="soundtrap")%>% dplyr::select(Time_UTC, narwhal,site,device)
narwhal_rink_AU18 <- read.csv(paste(path,"narwhal_detections/Rink_Glacier_2018-19_AuralM2_daily.csv",sep=''))%>% mutate(site="rink",device="aural")%>% dplyr::select(Time_UTC, narwhal,site,device)
narwhal_fish_AU19 <- read.csv(paste(path,"narwhal_detections/Rink_Glacier_Fischer_AuralM2_daily.csv",sep=''))%>% mutate(site="rink",device="aural")%>% dplyr::select(Time_UTC, narwhal,site,device)
narwhal_fish_ST19 <- read.csv(paste(path,"narwhal_detections/Rink_Glacier_Fischer_ST_daily.csv",sep=''))%>% mutate(site="rink",device="soundtrap")%>% dplyr::select(Time_UTC, narwhal,site,device)
narwhal_sver_AU18 <- read.csv(paste(path,"narwhal_detections/Sverdrup2018-19_AuralM2_daily.csv",sep=''))%>% mutate(site="sver",device="aural")%>% dplyr::select(Time_UTC, narwhal,site,device)
narwhal_dets <- rbind(narwhal_kong_AU18,
narwhal_kong_AU19,
narwhal_kong_ST19,
narwhal_rink_AU18,
narwhal_fish_AU19,
narwhal_fish_ST19,
narwhal_sver_AU18) %>%
mutate(time=as.character(strptime(as.Date(Time_UTC,format=c('%Y/%b/%d')),format='%Y-%m-%d'))) %>% dplyr::select(!Time_UTC)
# pool soundtrap and aural detections for 2019 data (i.e., take only one obs/day for each site)
narwhal_pooled <- narwhal_dets %>% group_by(site,time) %>%
filter(narwhal==max(narwhal),(row_number()==n()))
# ice velocity
kong_ice_vel <- read.csv(paste(path,"glacier_ice_velocity/kongoscar_ice_velocity_1D.csv",sep=''))%>% mutate(site="kong")
rink_ice_vel <- read.csv(paste(path,"glacier_ice_velocity/rink_ice_velocity_1D.csv",sep='')) %>% mutate(site="rink")
sver_ice_vel <- read.csv(paste(path,"glacier_ice_velocity/sverdrup_ice_velocity_1D.csv",sep='')) %>% mutate(site="sver")
ice_vel<-rbind(kong_ice_vel,rink_ice_vel,sver_ice_vel)
# glacier length (= terminus position)
kong_glacier_length <- read.csv(paste(path,"glacier_length/kongoscar_glacier_length_1D.csv",sep=''))%>% mutate(site="kong")
rink_glacier_length <- read.csv(paste(path,"glacier_length/rink_glacier_length_1D.csv",sep=''))%>% mutate(site="rink")
sver_glacier_length <- read.csv(paste(path,"glacier_length/sverdrup_glacier_length_1D.csv",sep=''))%>% mutate(site="sver")
glacier_len<-rbind(kong_glacier_length,rink_glacier_length,sver_glacier_length)
# runoff
# MAR
runoff_mar_kong <- read.csv(paste(path,"runoff/kongoscar_runoff_mar_1D.csv",sep=''))%>% mutate(site="kong")
runoff_mar_rink <- read.csv(paste(path,"runoff/rink_runoff_mar_1D.csv",sep=''))%>% mutate(site="rink")
runoff_mar_sver <- read.csv(paste(path,"runoff/sverdrup_runoff_mar_1D.csv",sep=''))%>% mutate(site="sver")
runoff_mar <- rbind(runoff_mar_kong,runoff_mar_rink,runoff_mar_sver) %>%
rename(runoff_mar=runoff)
# RACMO
runoff_racmo_kong <- read.csv(paste(path,"runoff/kongoscar_runoff_racmo_1D.csv",sep=''))%>%
mutate(site="kong")
runoff_racmo_rink <- read.csv(paste(path,"runoff/rink_runoff_racmo_1D.csv",sep=''))%>%
mutate(site="rink")
runoff_racmo_sver <- read.csv(paste(path,"runoff/sverdrup_runoff_racmo_1D.csv",sep=''))%>%
mutate(site="sver")
runoff_racmo <- rbind(runoff_racmo_kong,runoff_racmo_rink,runoff_racmo_sver) %>%
rename(runoff_racmo=runoff)
# sea ice
sea_ice_rink <- read.csv(paste(path,"sea_ice/fisher_seaice_cover_1D.csv",sep=''))%>% mutate(site="rink")
sea_ice_kong <- read.csv(paste(path,"sea_ice/kongoscar_seaice_cover_1D.csv",sep=''))%>% mutate(site="kong")
sea_ice_sver <- read.csv(paste(path,"sea_ice/sverdrup_seaice_cover_1D.csv",sep=''))%>% mutate(site="sver")
sea_ice<-rbind(sea_ice_rink,sea_ice_kong,sea_ice_sver)
# salinity
salt_surf_fish <- read.csv(paste(path,"salinity/fisher_salt_120m_1D.csv",sep=''))%>% mutate(site="rink")
salt_deep_fish <- read.csv(paste(path,"salinity/fisher_salt_220m_1D.csv",sep=''))%>% mutate(site="rink")
salt_surf_kong <- read.csv(paste(path,"salinity/kongoscar_salt_120m_1D.csv",sep=''))%>% mutate(site="kong") %>% mutate(time=as.character(as.Date(time,format='%m/%d/%Y')))
salt_deep_kong <- read.csv(paste(path,"salinity/kongoscar_salt_220m_1D.csv",sep=''))%>% mutate(site="kong")
salt_surf_rink <- read.csv(paste(path,"salinity/rink_salt_120m_1D.csv",sep=''))%>% mutate(site="rink")
salt_deep_rink <- read.csv(paste(path,"salinity/rink_salt_220m_1D.csv",sep=''))%>% mutate(site="rink")
salt_surf_sver <- read.csv(paste(path,"salinity/sverdrup_salt_120m_1D.csv",sep=''))%>% mutate(site="sver")
salt_deep_sver <- read.csv(paste(path,"salinity/sverdrup_salt_220m_1D.csv",sep=''))%>% mutate(site="sver")
salt_surf<-rbind(salt_surf_fish,salt_surf_kong,salt_surf_rink,salt_surf_sver) %>% rename(salt_surf=salinity)
salt_deep<-rbind(salt_deep_fish,salt_deep_kong,salt_deep_rink,salt_deep_sver) %>% rename(salt_deep=salinity)
# temperature
temp_surf_fish <- read.csv(paste(path,"temperature/fisher_temp_120m_1D.csv",sep=''))%>% mutate(site="rink")
temp_deep_fish <- read.csv(paste(path,"temperature/fisher_temp_220m_1D.csv",sep=''))%>% mutate(site="rink")
temp_surf_kong <- read.csv(paste(path,"temperature/kongoscar_temp_120m_1D.csv",sep=''))%>% mutate(site="kong")
temp_deep_kong <- read.csv(paste(path,"temperature/kongoscar_temp_220m_1D.csv",sep=''))%>% mutate(site="kong")
temp_surf_rink <- read.csv(paste(path,"temperature/rink_temp_120m_1D.csv",sep=''))%>% mutate(site="rink")
temp_deep_rink <- read.csv(paste(path,"temperature/rink_temp_220m_1D.csv",sep=''))%>% mutate(site="rink")
temp_surf_sver <- read.csv(paste(path,"temperature/sverdrup_temp_120m_1D.csv",sep=''))%>% mutate(site="sver")
temp_deep_sver <- read.csv(paste(path,"temperature/sverdrup_temp_220m_1D.csv",sep=''))%>% mutate(site="sver")
temp_surf <- rbind(temp_surf_fish,temp_surf_kong,temp_surf_rink,temp_surf_sver) %>% rename(temp_surf=temperature)
temp_deep <- rbind(temp_deep_fish,temp_deep_kong,temp_deep_rink,temp_deep_sver) %>% rename(temp_deep=temperature)
# table of additional glacier variables
glacier_vars_df <- read.csv(paste(path,"narwhal_model_glacier_vars.csv",sep=''))
## make data tidy and join all vars into one df
# ALL narwhal detections (aural + soundtrap)
model_vars_df <- runoff_racmo %>%
left_join(runoff_mar, by = c('time', 'site')) %>%
left_join(salt_surf, by = c('time', 'site')) %>%
left_join(salt_deep, by = c('time', 'site')) %>%
left_join(temp_surf, by = c('time', 'site')) %>%
left_join(temp_deep, by = c('time', 'site')) %>%
left_join(sea_ice, by = c('time', 'site')) %>%
left_join(ice_vel, by = c('time', 'site')) %>%
left_join(glacier_len, by = c('time', 'site')) %>%
left_join(narwhal_dets, by = c('time', 'site')) %>%
mutate(DOY=as.numeric(strftime(as.Date(time),format='%j')),
year = strftime(as.Date(time),format='%Y'))
# pooled narwhal detections (i.e., any positive detection from Aural or ST = 1)
narwhal_pooled_dets <- narwhal_pooled %>% dplyr::select(narwhal, site, time)
model_vars_pooled_df <- runoff_racmo %>%
left_join(runoff_mar, by = c('time', 'site')) %>%
left_join(salt_surf, by = c('time', 'site')) %>%
left_join(salt_deep, by = c('time', 'site')) %>%
left_join(temp_surf, by = c('time', 'site')) %>%
left_join(temp_deep, by = c('time', 'site')) %>%
left_join(sea_ice, by = c('time', 'site')) %>%
left_join(ice_vel, by = c('time', 'site')) %>%
left_join(glacier_len, by = c('time', 'site')) %>%
left_join(narwhal_pooled_dets, by = c('time', 'site')) %>%
mutate(DOY=as.numeric(strftime(as.Date(time),format='%j')),
year = strftime(as.Date(time),format='%Y'))
# check to make sure values are
model_vars_df %>% filter(time=='2019-09-30')
## check for correlations between all covariates
# detections separated by device
model_vars_num <- model_vars_df %>% dplyr::select(!c(narwhal, time, site, year, device)) %>% cor(use = "complete.obs")
# pooled observations
model_vars_num <- model_vars_pooled_df %>% dplyr::select(!c(narwhal, time, site, year)) %>% cor(use = "complete.obs")
# remove velocity, temp_deep, and salt_deep
model_vars_num <- model_vars_df %>%
dplyr::select(!c(narwhal, time, site, year, device, velocity, salt_deep, temp_deep)) %>%
cor(use = "complete.obs")
# run correlation test
corrplot::corrplot(model_vars_num, method = 'number')
# ensure vars are numeric and drop na (=select complete observations)
model_data <- model_vars_df %>%
mutate_at(vars(runoff_racmo,salt_surf,temp_surf,salt_deep,temp_deep,ice_cover_percent,
velocity,glacier_length,DOY),as.numeric) %>%
drop_na()
model_data_pooled <- model_vars_pooled_df %>%
mutate_at(vars(runoff_racmo,salt_surf,temp_surf,salt_deep,temp_deep,ice_cover_percent,
velocity,glacier_length,DOY),as.numeric) %>%
drop_na()
## since we know narwhals cannot survive in Melville Bay after the freeze up, we will select data from before the fast ice comes in
## here, I define the freeze up date as the day when sea ice > 75%
## freeze up date in 2018
head(model_data_pooled %>% dplyr::filter(ice_cover_percent>75,year==2018))
# 2018-10-28 which is equal to DOY=301 # sverdrup froze up first
## freeze up date in 2019
model_data_pooled %>% dplyr::filter(ice_cover_percent>75,year==2019,DOY>100)
# 2019-12-23 which is equal to DOY=357 # rink froze up first
## filter all data before these dates
mdl_data_open_water2018 <- model_data_pooled %>% filter(year==2018) %>%
filter(DOY<301)
mdl_data_open_water2019 <- model_data_pooled %>% filter(year==2019) %>%
filter(DOY>100,DOY<357)
# sanity check plots
qplot(as.Date(time),ice_cover_percent, geom="point", data = mdl_data_open_water2018)
qplot(as.Date(time),ice_cover_percent, geom="point", data = mdl_data_open_water2019)
## join both datasets
mdl_data_b4freeze_pooled <- rbind(mdl_data_open_water2018, mdl_data_open_water2019)
qplot(as.Date(time),ice_cover_percent, geom="point", data = mdl_data_b4freeze_pooled)
## model with 'device' variable (unpooled detections)
mdl_global <- glm(narwhal ~
temp_surf+
temp_deep+
salt_surf+
salt_deep+
ice_cover_percent+
runoff_racmo+
glacier_length+
device+
site+
DOY,
data = mdl_data_b4freeze,
family=binomial(link="logit"),
na.action="na.fail")
## model without 'device' (pooled detections)
mdl_global_pooled <- glm(narwhal ~
temp_surf+
temp_deep+
salt_surf+
salt_deep+
ice_cover_percent+
runoff_racmo+
glacier_length+
site+
DOY,
data = mdl_data_b4freeze_pooled,
family=binomial(link="logit"),na.action="na.fail")
# print summary output
summary(mdl_global_pooled)
faraway::sumary(mdl_global_pooled)
## model without 'device' (pooled detections)
mdl_global_pooled <- glm(narwhal ~
temp_surf+
temp_deep+
salt_surf+
salt_deep+
ice_cover_percent+
runoff_mar+
glacier_length+
site+
DOY,
data = mdl_data_b4freeze_pooled,
family=binomial(link="logit"),na.action="na.fail")
# print summary output
summary(mdl_global_pooled)
## filter all data before these dates
# not pooled
mdl_data_open_water2018 <- model_data %>% filter(year==2018) %>%
filter(DOY<301)
mdl_data_open_water2019 <- model_data %>% filter(year==2019) %>%
filter(DOY>100,DOY<357)
# pooled
mdl_data_open_water2018_pool <- model_data_pooled %>% filter(year==2018) %>%
filter(DOY<301)
mdl_data_open_water2019_pool <- model_data_pooled %>% filter(year==2019) %>%
filter(DOY>100,DOY<357)
# sanity check plots
qplot(as.Date(time),ice_cover_percent, geom="point", data = mdl_data_open_water2018)
qplot(as.Date(time),ice_cover_percent, geom="point", data = mdl_data_open_water2019)
## join both datasets
mdl_data_b4freeze <- rbind(mdl_data_open_water2018, mdl_data_open_water2019)
mdl_data_b4freeze_pooled <- rbind(mdl_data_open_water2018_pool, mdl_data_open_water2019_pool)
qplot(as.Date(time),ice_cover_percent, geom="point", data = mdl_data_b4freeze_pooled)
## model with 'device' variable (unpooled detections)
mdl_global <- glm(narwhal ~
temp_surf+
temp_deep+
salt_surf+
salt_deep+
ice_cover_percent+
runoff_racmo+
glacier_length+
device+
site+
DOY,
data = mdl_data_b4freeze,
family=binomial(link="logit"),
na.action="na.fail")
# print summary output
summary(mdl_global)
